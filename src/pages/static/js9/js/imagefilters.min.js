var ImageFilters;
ImageFilters=function(){function n(e,d,a,b,c){var f,g,h,j,k,s,m,p,q,u,l,r,n=Math.round(Math.sqrt(a.length)),v=Math.floor(n/2),t=d.width,w=d.height;g=4*t*w;var x=d.data;e=e.createImageData(d.width,d.height);for(f=0;f<g;f++)e[f]=x[f];if("[object Array]"!==Object.prototype.toString.call(a))return d;void 0===b&&(b=!0);b=b?1:0;if(c){g=a.reduce(function(a,b){return a+b});for(c=0;c<a.length;++c)a[c]/=g}for(g=0;g<w;g++)for(c=0;c<t;c++){h=g;f=c;s=4*(g*t+c);for(p=r=l=u=q=0;p<n;p++)for(m=0;m<n;m++)k=Math.min(w-
1,Math.max(0,h+p-v)),j=Math.min(t-1,Math.max(0,f+m-v)),j=4*(k*t+j),k=a[p*n+m],q+=e[j]*k,u+=e[j+1]*k,l+=e[j+2]*k,r+=e[j+3]*k;x[s]=q;x[s+1]=u;x[s+2]=l;x[s+3]=r+b*(255-r)}return d}function z(e,d,a,b){var c,f,g,h,j,k,s,m,p,q,n,l;e=Math.round(Math.sqrt(a.length));var r=Math.floor(e/2),y=d.data,v=d.width;d=d.height;var t=new Float32Array(4*v*d),w=b?1:0;for(c=0;c<d;c++)for(b=0;b<v;b++){g=c;f=b;k=4*(c*v+b);for(m=l=n=q=p=0;m<e;m++)for(s=0;s<e;s++)j=Math.min(d-1,Math.max(0,g+m-r)),h=Math.min(v-1,Math.max(0,
f+s-r)),h=4*(j*v+h),j=a[m*e+s],p+=y[h]*j,q+=y[h+1]*j,n+=y[h+2]*j,l+=y[h+3]*j;t[k]=p;t[k+1]=q;t[k+2]=n;t[k+3]=l+w*(255-l)}return t}function A(e,d){var a,b,c=d.data;for(a=0;a<c.length;a+=4)b=0.299*c[a]+0.587*c[a+1]+0.114*c[a+2],c[a]=c[a+1]=c[a+2]=b;return d}function B(e,d){var a,b,c=d.data;for(a=0;a<c.length;a+=4)b=(c[a]+c[a+1]+c[a+2])/3,c[a]=c[a+1]=c[a+2]=b;return d}return{convolve:n,luminance:function(e,d){var a,b,c=d.data;for(a=0;a<c.length;a+=4)b=0.2126*c[a]+0.7152*c[a+1]+0.0722*c[a+2],c[a]=c[a+
1]=c[a+2]=b;return d},greyscale:A,greyscaleAvg:B,brighten:function(e,d,a){var b=d.data;a=a||10;for(e=0;e<b.length;e+=4)b[e]+=a,b[e+1]+=a,b[e+2]+=a;return d},noise:function(e,d,a,b){var c,f,g,h=d.data;3>arguments.length&&(a=-30,b=30);f=b-a;for(c=0;c<h.length;c+=4)g=Math.floor(Math.random()*f-b),h[c]+=g,h[c+1]+=g,h[c+2]+=g;return d},duotone:function(e,d,a){var b,c=d.data;switch(a){case "r":a=0;break;case "g":a=1;break;case "b":a=2;break;default:a=0}for(e=0;e<c.length;e+=4)b=(c[e]+c[e+1]+c[e+2]-c[e+
a])/2,c[e+a]=b;return d},invert:function(e,d){var a,b=d.data;for(a=0;a<b.length;a+=4)b[a]=255-b[a],b[a+1]=255-b[a+1],b[a+2]=255-b[a+2];return d},pixelate:function(e,d,a){var b,c,f,g,h,j,k,n,m,p,q=d.width,u=d.height,l=d.data;3>arguments.length&&(a=2);p=2*a;for(k=a;k<u-a;k+=p)for(j=a;j<q-a;j+=p){f=4*(q*k+j);b=l[f];c=l[f+1];f=l[f+2];for(m=-a;m<a;++m){h=q*(k+m);for(n=-a;n<a;++n)g=4*(h+(j+n)),l[g]=b,l[g+1]=c,l[g+2]=f}}return d},sobel:function(e,d,a){var b,c,f,g,h=d.data;d=B(e,d);g=z(e,d,[-1,0,1,-2,0,2,
-1,0,1]);f=z(e,d,[-1,-2,-1,0,0,0,1,2,1]);if(a)for(a=0;a<h.length;a+=4)b=Math.abs(f[a]),c=Math.abs(g[a]),h[a]=b,h[a+1]=c,h[a+2]=(b+c)/4;else{for(a=0;a<h.length;a+=4)b=Math.abs(f[a]),c=Math.abs(g[a]),h[a]=b,h[a+1]=c,h[a+2]=(b+c)/2;A(e,d)}return d},medianFilter:function(e,d){return n(e,d,[1,0,0,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,0,0,0,1],!0,!0)},sepia:function(e,d){var a,b,c,f,g=d.data;for(a=0;a<g.length;a+=4)b=g[a],c=g[a+1],f=g[a+2],g[a]=0.393*b+0.769*c+0.189*f,g[a+1]=0.349*b+0.686*c+0.168*f,g[a+2]=
0.272*b+0.534*c+0.131*f;return d},contrast:function(e,d,a){var b,c=d.data;3>arguments.length&&(a=2);-100>a?a=-100:100<a&&(a=100);for(b=0;b<c.length;b+=4)c[b]=255*((c[b]/255-0.5)*a+0.5),c[b+1]=255*((c[b+1]/255-0.5)*a+0.5),c[b+2]=255*((c[b+2]/255-0.5)*a+0.5);return d},threshold:function(e,d,a,b,c){var f,g,h,j,k=d.data;3>arguments.length?(a=10,b=0,c=255):5>arguments.length&&(b=0,c=255);for(f=0;f<k.length-1;f+=4)g=k[f],h=k[f+1],j=k[f+2],g=0.2126*g+0.7152*h+0.0722*j>=a?c:b,k[f]=k[f+1]=k[f+2]=g;return d},
gamma:function(e,d,a){var b,c=d.data;3>arguments.length&&(a=0.2);for(b=0;b<c.length;b+=4)c[b]=255*Math.pow(c[b]/255,a),c[b+1]=255*Math.pow(c[b+1]/255,a),c[b+2]=255*Math.pow(c[b+2]/255,a);return d},gaussBlur5:function(e,d){return n(e,d,[0.003,0.0133,0.0219,0.0133,0.003,0.0133,0.0596,0.0983,0.0596,0.0133,0.0219,0.0983,0.1621,0.0983,0.0219,0.0133,0.0596,0.0983,0.0596,0.0133,0.003,0.0133,0.0219,0.0133,0.003])},posterize:function(e,d,a){var b,c,f,g,h=[];c=1;var j=d.data;3>arguments.length&&(a=40);for(b=
0;256>b;++b)b<a*c?h[b]=a*(c-1):(h[b]=a*c,++c);for(b=0;b<j.length;b+=4)c=j[b],f=j[b+1],g=j[b+2],j[b]=h[c],j[b+1]=h[f],j[b+2]=h[g];return d},scatter:function(e,d,a){var b,c,f,g,h,j,k,n,m,p,q=d.width,u=d.height,l=d.data;3>arguments.length&&(a=5);h=2*a;j=(a-1)*a;for(c=a;c<u-a;c+=h)for(b=a;b<q-a;b+=h){f=!1;for(g=0;!f;){k=Math.floor(Math.random()*h-a);n=Math.floor(Math.random()*h-a);m=Math.floor(Math.random()*h-a);p=Math.floor(Math.random()*h-a);var r=[];k=4*(q*(n+c)+(k+b));m=4*(q*(p+c)+(m+b));r[0]=l[k];
r[1]=l[k+1];r[2]=l[k+2];r[3]=l[k+3];l[k]=l[m];l[k+1]=l[m+1];l[k+2]=l[m+2];l[k+3]=l[m+3];l[m]=r[0];l[m+1]=r[1];l[m+2]=r[2];l[m+3]=r[3];++g;g>j&&(f=!0)}}return d},solarize:function(e,d,a){var b,c,f,g,h,j=d.data;3>arguments.length&&(a=50);for(b=0;b<j.length;++b)c=j[b],f=j[b+1],g=j[b+2],h=(c+f+g)/3,h<a&&(j[b]=255-c,j[b+1]=255-f,j[b+2]=255-g);return d},sharpen:function(e,d,a){3>arguments.length&&(a=20);return n(e,d,[0,-3,0,-3,a,-3,0,-3,0],!0,!0)},edgeDetect:function(e,d){return n(e,d,[-1,-1,-1,-1,8,-1,
-1,-1,-1])},blur:function(e,d){return n(e,d,[1,2,1,2,1,2,1,2,1],!0,!0)},emboss:function(e,d,a){3>arguments.length&&(a=95);return n(e,d,[-18,-9,9,-9,100-a,9,0,9,18],!0,!0)},lighten:function(e,d,a){if(3>arguments.length||0>a)a=12/9;return n(e,d,[0,0,0,0,a,0,0,0,0])},darken:function(e,d,a){if(3>arguments.length||1<a)a=6/9;return n(e,d,[0,0,0,0,a,0,0,0,0])}}}();
