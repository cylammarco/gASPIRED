(function(u){u.plot.plugins.push({init:function(j){function F(b){for(var d=0,a=0,p=0,k=c.series.pie.combine.color,h=[],g=0;g<b.length;++g){var e=b[g].data;u.isArray(e)&&1==e.length&&(e=e[0]);u.isArray(e)?e[1]=!isNaN(parseFloat(e[1]))&&isFinite(e[1])?+e[1]:0:e=!isNaN(parseFloat(e))&&isFinite(e)?[1,+e]:[1,0];b[g].data=[e]}for(g=0;g<b.length;++g)d+=b[g].data[0][1];for(g=0;g<b.length;++g)e=b[g].data[0][1],e/d<=c.series.pie.combine.threshold&&(a+=e,p++,k||(k=b[g].color));for(g=0;g<b.length;++g)e=b[g].data[0][1],
(2>p||e/d>c.series.pie.combine.threshold)&&h.push(u.extend(b[g],{data:[[1,e]],color:b[g].color,label:b[g].label,angle:2*e*Math.PI/d,percent:e/(d/100)}));1<p&&h.push({data:[[1,a]],color:k,label:c.series.pie.combine.label,angle:2*a*Math.PI/d,percent:a/(d/100)});return h}function B(b){if(0<c.series.pie.innerRadius){b.save();var d=1<c.series.pie.innerRadius?c.series.pie.innerRadius:t*c.series.pie.innerRadius;b.globalCompositeOperation="destination-out";b.beginPath();b.fillStyle=c.series.pie.stroke.color;
b.arc(0,0,d,0,2*Math.PI,!1);b.fill();b.closePath();b.restore();b.save();b.beginPath();b.strokeStyle=c.series.pie.stroke.color;b.arc(0,0,d,0,2*Math.PI,!1);b.stroke();b.closePath();b.restore()}}function G(b){C("plothover",b)}function H(b){C("plotclick",b)}function C(b,d){var m=j.offset(),p=parseInt(d.pageX-m.left);a:{for(var m=parseInt(d.pageY-m.top),k=j.getData(),h=j.getOptions(),h=1<h.series.pie.radius?h.series.pie.radius:t*h.series.pie.radius,g,e,v=0;v<k.length;++v){var f=k[v];if(f.pie.show){a.save();
a.beginPath();a.moveTo(0,0);a.arc(0,0,h,f.startAngle,f.startAngle+f.angle/2,!1);a.arc(0,0,h,f.startAngle+f.angle/2,f.startAngle+f.angle,!1);a.closePath();g=p-s;e=m-x;if(a.isPointInPath){if(a.isPointInPath(p-s,m-x)){a.restore();p={datapoint:[f.percent,f.data],dataIndex:0,series:f,seriesIndex:v};break a}}else{var l=h*Math.cos(f.startAngle),n=h*Math.sin(f.startAngle),z=h*Math.cos(f.startAngle+f.angle/4),y=h*Math.sin(f.startAngle+f.angle/4),u=h*Math.cos(f.startAngle+f.angle/2),I=h*Math.sin(f.startAngle+
f.angle/2),J=h*Math.cos(f.startAngle+f.angle/1.5),K=h*Math.sin(f.startAngle+f.angle/1.5),r=h*Math.cos(f.startAngle+f.angle),L=h*Math.sin(f.startAngle+f.angle),l=[[0,0],[l,n],[z,y],[u,I],[J,K],[r,L]];g=[g,e];e=!1;n=-1;z=l.length;for(y=z-1;++n<z;y=n)(l[n][1]<=g[1]&&g[1]<l[y][1]||l[y][1]<=g[1]&&g[1]<l[n][1])&&g[0]<(l[y][0]-l[n][0])*(g[1]-l[n][1])/(l[y][1]-l[n][1])+l[n][0]&&(e=!e);if(e){a.restore();p={datapoint:[f.percent,f.data],dataIndex:0,series:f,seriesIndex:v};break a}}a.restore()}}p=null}if(c.grid.autoHighlight)for(m=
0;m<q.length;++m)k=q[m],k.auto==b&&!(p&&k.series==p.series)&&(k=k.series,null==k&&(q=[],j.triggerRedrawOverlay()),k=D(k),-1!=k&&(q.splice(k,1),j.triggerRedrawOverlay()));p&&(m=p.series,k=D(m),-1==k?(q.push({series:m,auto:b}),j.triggerRedrawOverlay()):b||(q[k].auto=!1));w.trigger(b,[{pageX:d.pageX,pageY:d.pageY},p])}function D(b){for(var d=0;d<q.length;++d)if(q[d].series==b)return d;return-1}var E=null,w=null,c=null,t=null,s=null,x=null,A=!1,a=null,q=[];j.hooks.processOptions.push(function(b,d){d.series.pie.show&&
(d.grid.show=!1,"auto"==d.series.pie.label.show&&(d.series.pie.label.show=d.legend.show?!1:!0),"auto"==d.series.pie.radius&&(d.series.pie.radius=d.series.pie.label.show?0.75:1),1<d.series.pie.tilt?d.series.pie.tilt=1:0>d.series.pie.tilt&&(d.series.pie.tilt=0))});j.hooks.bindEvents.push(function(b,d){var a=b.getOptions();a.series.pie.show&&(a.grid.hoverable&&d.unbind("mousemove").mousemove(G),a.grid.clickable&&d.unbind("click").click(H))});j.hooks.processDatapoints.push(function(b){b.getOptions().series.pie.show&&
!A&&(A=!0,E=b.getCanvas(),w=u(E).parent(),c=b.getOptions(),b.setData(F(b.getData())))});j.hooks.drawOverlay.push(function(b,a){if(b.getOptions().series.pie.show){var c=b.getOptions(),p=1<c.series.pie.radius?c.series.pie.radius:t*c.series.pie.radius;a.save();a.translate(s,x);a.scale(1,c.series.pie.tilt);for(var k=0;k<q.length;++k){var h=q[k].series;0>=h.angle||isNaN(h.angle)||(a.fillStyle="rgba(255, 255, 255, "+c.series.pie.highlight.opacity+")",a.beginPath(),1E-9<Math.abs(h.angle-2*Math.PI)&&a.moveTo(0,
0),a.arc(0,0,p,h.startAngle,h.startAngle+h.angle/2,!1),a.arc(0,0,p,h.startAngle+h.angle/2,h.startAngle+h.angle,!1),a.closePath(),a.fill())}B(a);a.restore()}});j.hooks.draw.push(function(b,d){if(b.getOptions().series.pie.show){var m=function(){a.clearRect(0,0,k,h);w.children().filter(".pieLabel, .pieLabelBackground").remove()},p=function(){function b(c,d,e){0>=c||isNaN(c)||(e?a.fillStyle=d:(a.strokeStyle=d,a.lineJoin="round"),a.beginPath(),1E-9<Math.abs(c-2*Math.PI)&&a.moveTo(0,0),a.arc(0,0,g,f,f+
c/2,!1),a.arc(0,0,g,f+c/2,f+c,!1),a.closePath(),f+=c,e?a.fill():a.stroke())}var d=Math.PI*c.series.pie.startAngle,g=1<c.series.pie.radius?c.series.pie.radius:t*c.series.pie.radius;a.save();a.translate(s,x);a.scale(1,c.series.pie.tilt);a.save();for(var f=d,j=0;j<e.length;++j)e[j].startAngle=f,b(e[j].angle,e[j].color,!0);a.restore();if(0<c.series.pie.stroke.width){a.save();a.lineWidth=c.series.pie.stroke.width;f=d;for(j=0;j<e.length;++j)b(e[j].angle,c.series.pie.stroke.color,!1);a.restore()}B(a);a.restore();
if(c.series.pie.label.show)a:{for(var j=1<c.series.pie.label.radius?c.series.pie.label.radius:t*c.series.pie.label.radius,p=0;p<e.length;++p){var r;if(r=e[p].percent>=100*c.series.pie.label.threshold){r=e[p];var n=d,m=p;if(0==r.data[0][1])r=!0;else{var l=c.legend.labelFormatter,q=void 0,v=c.series.pie.label.formatter,q=l?l(r.label,r):r.label;v&&(q=v(q,r));l=(n+r.angle+n)/2;n=s+Math.round(Math.cos(l)*j);l=x+Math.round(Math.sin(l)*j)*c.series.pie.tilt;w.append("<span class='pieLabel' id='pieLabel"+
m+"' style='position:absolute;top:"+l+"px;left:"+n+"px;'>"+q+"</span>");m=w.children("#pieLabel"+m);q=l-m.height()/2;l=n-m.width()/2;m.css("top",q);m.css("left",l);0<0-q||0<0-l||0>h-(q+m.height())||0>k-(l+m.width())?r=!1:(0!=c.series.pie.label.background.opacity&&(n=c.series.pie.label.background.color,null==n&&(n=r.color),r="top:"+q+"px;left:"+l+"px;",u("<div class='pieLabelBackground' style='position:absolute;width:"+m.width()+"px;height:"+m.height()+"px;"+r+"background-color:"+n+";'></div>").css("opacity",
c.series.pie.label.background.opacity).insertBefore(m)),r=!0)}r=!r}if(r){d=!1;break a}d+=e[p].angle}d=!0}else d=!0;return d};if(w){var k=b.getPlaceholder().width(),h=b.getPlaceholder().height(),g=w.children().filter(".legend").children().width()||0;a=d;A=!1;t=Math.min(k,h/c.series.pie.tilt)/2;x=h/2+c.series.pie.offset.top;s=k/2;"auto"==c.series.pie.offset.left?(s=c.legend.position.match("w")?s+g/2:s-g/2,s<t?s=t:s>k-t&&(s=k-t)):s+=c.series.pie.offset.left;var e=b.getData(),g=0;do if(0<g&&(t*=0.95),
g+=1,m(),0.8>=c.series.pie.tilt){var j=c.series.pie.shadow.left,f=c.series.pie.shadow.top,l=c.series.pie.shadow.alpha,n=1<c.series.pie.radius?c.series.pie.radius:t*c.series.pie.radius;if(!(n>=k/2-j||n*c.series.pie.tilt>=h/2-f||10>=n)){a.save();a.translate(j,f);a.globalAlpha=l;a.fillStyle="#000";a.translate(s,x);a.scale(1,c.series.pie.tilt);for(j=1;10>=j;j++)a.beginPath(),a.arc(0,0,n,0,2*Math.PI,!1),a.fill(),n-=j;a.restore()}}while(!p()&&10>g);10<=g&&(m(),w.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>"));
b.setSeries&&b.insertLegend&&(b.setSeries(e),b.insertLegend())}}})},options:{series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(j,u){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+u.color+";'>"+j+"<br/>"+Math.round(u.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,
label:"Other"},highlight:{opacity:0.5}}}},name:"pie",version:"1.1"})})(jQuery);
